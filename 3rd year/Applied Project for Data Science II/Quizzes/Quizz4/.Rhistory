# Remover tudo!
rm(list = ls())
# Incluir as libraries de que necessita
library(tidyverse)
library(conflicted)
conflicts_prefer(dplyr::filter)
library(here)
library(knitr)
df <- read.csv(here("acidentes.csv"), na.strings = c("NÃO DEFINIDO")) %>%
mutate(Datahora = ymd_hms(Datahora)) %>%
mutate(Longitude.GPS = ifelse(Longitude.GPS > 0, Longitude.GPS * -1, Longitude.GPS),
Latitude.GPS = ifelse(Latitude.GPS < 0, Latitude.GPS * -1, Latitude.GPS)) %>%
filter(Longitude.GPS > -10 & Longitude.GPS < -6 & Latitude.GPS > 37 & Latitude.GPS < 42)
summary(df)
df %>%
select(2:14) %>%
filter(Distrito %in% c("Leiria", "Lisboa", "Santarém", "Setúbal")) %>%
mutate(Distrito = factor(Distrito)) %>%
drop_na() -> df2
df2 %>%
count(Distrito)
df2 %>%
count(Distrito) %>%
kable()
set.seed(123)
library(dbscan)
df2 %>%
select(Latitude.GPS, Longitude.GPS) %>%
dbscan(eps = 0.07, minPts = 40) -> clusters
df2 %>%
mutate(cluster = clusters$cluster %>% as.factor) -> df.clusters
df.clusters %>%
ggplot(aes(x = Longitude.GPS, y = Latitude.GPS, color = cluster)) +
geom_point()
clusters
# mapa
pak::pak("ropensci/rnaturalearthhires")
library(rnaturalearth)
portugal <- ne_states(country = "portugal", returnclass = "sf")
portugal %>%
ggplot() +
# color districts
geom_sf() +
geom_point(data = df.clusters, alpha = 1, size = 1, aes(x = Longitude.GPS, y = Latitude.GPS, color = cluster)) +
coord_sf(xlim = c(-10, -7), ylim = c(37.7, 40.1)) +
theme_bw()
# portugal distribuição pelos 4 distritos (Leiria, Lisboa, Santarém, Setúbal)
portugal %>%
ggplot() +
geom_sf() +
geom_point(data = df.clusters, alpha = 1, size = 1, aes(x = Longitude.GPS, y = Latitude.GPS, color = Distrito)) +
coord_sf(xlim = c(-10, -7), ylim = c(37.7, 40.1)) +
theme_bw()
if (F) {
db_df <- data.frame(clusters$cluster)
asd <- merge(df2, db_df, by.x = 0, by.y=0, sort=FALSE)
cluster_0 <- asd[which(asd$clusters.cluster==0),]
cluster_1 <- asd[which(asd$clusters.cluster==1),]
cluster_2 <- asd[which(asd$clusters.cluster==2),]
cluster_3 <- asd[which(asd$clusters.cluster==3),]
cluster_4 <- asd[which(asd$clusters.cluster==4),]
write.csv(cluster_0, "cluster_0.csv")
write.csv(cluster_1, "cluster_1.csv")
write.csv(cluster_2, "cluster_2.csv")
write.csv(cluster_3, "cluster_3.csv")
write.csv(cluster_4, "cluster_4.csv")
}
df.clusters %>%
select(Distrito, cluster) %>%
table()
# grafico de barras
df.clusters %>%
select(Distrito, cluster) %>%
ggplot(aes(x = Distrito, fill = cluster)) +
geom_bar(position = "fill")
# Distrito
lsr::cramersV(df.clusters$Distrito, df.clusters$cluster) %>% round(3)
lsr::cramersV(df.clusters$Entidades.Fiscalizadoras, df.clusters$cluster, simulate.p.value=TRUE) %>% round(3)
lsr::cramersV(df.clusters$Dia.da.Semana, df.clusters$cluster) %>% round(3)
lsr::cramersV(df.clusters$Características.Tecnicas1, df.clusters$cluster) %>% round(3)
lsr::cramersV(df.clusters$Cond.Aderência, df.clusters$cluster, simulate.p.value=TRUE) %>% round(3)
options(scipen = 999)
df.clusters %>%
# select if numeric or cluster
select(where(is.numeric)) %>%
aov(df.clusters$cluster %>% as.numeric ~ ., data = .) %>%
lsr::etaSquared() %>%
as.data.frame() %>%
select(eta.sq) %>%
mutate(eta = sqrt(eta.sq)) %>%
arrange(-eta) %>%
round(3)
table(df.clusters$cluster, df.clusters$Distrito) %>% t() %>%
prop.table(.,2) %>% round(3)*100
df %>% filter(Concelho == "Abrantes") %>% select(Latitude.GPS, Longitude.GPS) -> abrantes
lat_abrantes.min <- min(abrantes$Latitude.GPS)
lat_abrantes.max <- max(abrantes$Latitude.GPS)
long_abrantes.min <- min(abrantes$Longitude.GPS)
long_abrantes.max <- max(abrantes$Longitude.GPS)
lat_abrantes.mean <- mean(abrantes$Latitude.GPS)
long_abrantes.mean <- mean(abrantes$Longitude.GPS)
# centro oficial: 39,464294, -8,197861
centroide_abrantes_lat <- 39.464294
centroide_abrantes_long <- -8.197861
tibble(lat_abrantes.min, lat_abrantes.max, lat_abrantes.mean, centroide_abrantes_lat, long_abrantes.min, long_abrantes.max, long_abrantes.mean, centroide_abrantes_long) %>% t() %>% round(1)
# df.clusters %>% filter(Latitude.GPS > 39.4 & Latitude.GPS < 39.5 & Longitude.GPS > -8.2 & Longitude.GPS < -8.1) %>% select(Distrito, cluster) %>% table()
abrantes<-matrix (NA ,1,2)
abrantes[1,]<-c(39.5, -8.2)
(pred_abrantes <- predict(clusters,as.data.frame(abrantes),df.clusters[,6:7]))
df %>% filter(Concelho == "Obidos") %>% select(Latitude.GPS, Longitude.GPS) -> obidos
lat_obidos.min <- min(obidos$Latitude.GPS)
lat_obidos.max <- max(obidos$Latitude.GPS)
long_obidos.min <- min(obidos$Longitude.GPS)
long_obidos.max <- max(obidos$Longitude.GPS)
(lat_obidos.mean <- mean(obidos$Latitude.GPS))
(long_obidos.mean <- mean(obidos$Longitude.GP))
obidos <- matrix(NA, 1, 2)
obidos[1,] <- c(39.30, -9.11)
(pred_obidos <- predict(clusters, as.data.frame(obidos), df.clusters[,6:7]))
